{"remainingRequest":"/Users/suhang/Template/tradingview/demo2/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/suhang/Template/tradingview/demo2/src/components/sSimpleCrop/modules/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/suhang/Template/tradingview/demo2/src/components/sSimpleCrop/modules/index.vue","mtime":1597631836919},{"path":"/Users/suhang/Template/tradingview/demo2/node_modules/cache-loader/dist/cjs.js","mtime":1598844172828},{"path":"/Users/suhang/Template/tradingview/demo2/node_modules/babel-loader/lib/index.js","mtime":1598844172845},{"path":"/Users/suhang/Template/tradingview/demo2/node_modules/cache-loader/dist/cjs.js","mtime":1598844172828},{"path":"/Users/suhang/Template/tradingview/demo2/node_modules/vue-loader/lib/index.js","mtime":1598844194174}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KCmltcG9ydCBDb3JlIGZyb20gIi4vaW5kZXguanMiOwoKZXhwb3J0IGRlZmF1bHQgewogIF9pbnN0YW5jZTogbnVsbCwgLy/nu4Tku7blrp7kvosKCiAgcHJvcHM6IFsiY3JvcFBhcmFtcyJdLAoKICBtb3VudGVkKCkgewogICAgdGhpcy5jcm9wUGFyYW1zLmNyb3BDYWxsYmFjayA9IHRoaXMuY3JvcENhbGxiYWNrLmJpbmQodGhpcyk7CiAgICB0aGlzLmNyb3BQYXJhbXMudXBsb2FkQ2FsbGJhY2sgPSB0aGlzLnVwbG9hZENhbGxiYWNrLmJpbmQodGhpcyk7CiAgICB0aGlzLmNyb3BQYXJhbXMuY2xvc2VDYWxsYmFjayA9IHRoaXMuY2xvc2VDYWxsYmFjay5iaW5kKHRoaXMpOwogICAgdGhpcy5faW5zdGFuY2UgPSBuZXcgQ29yZSh0aGlzLmNyb3BQYXJhbXMpOwogIH0sCgogIG1ldGhvZHM6IHsKICAgIC8v5YWz6Zet5Zue6LCDCiAgICBjbG9zZUNhbGxiYWNrKCkgewogICAgICB0aGlzLiRlbWl0KCJjbG9zZSIpOwogICAgfSwKCiAgICAvL+S4iuS8oOWbvueJh+WbnuiwgwogICAgdXBsb2FkQ2FsbGJhY2soKSB7CiAgICAgIGxldCBzcmMgPSB0aGlzLl9pbnN0YW5jZSA/IHRoaXMuX2luc3RhbmNlLnNyYyA6IHRoaXMuY3JvcFBhcmFtcy5zcmM7CiAgICAgIHRoaXMuJGVtaXQoInVwbG9hZCIsIHNyYyk7CiAgICB9LAoKICAgIC8v6KOB5Ymq5Zue6LCDCiAgICBjcm9wQ2FsbGJhY2soKSB7CiAgICAgIGxldCAkcmVzdWx0Q2FudmFzID0gdGhpcy5faW5zdGFuY2UgPyB0aGlzLl9pbnN0YW5jZS4kcmVzdWx0Q2FudmFzIDogbnVsbDsKICAgICAgdGhpcy4kZW1pdCgiY3JvcCIsICRyZXN1bHRDYW52YXMpOwogICAgfSwKCiAgICAvL+WxnuaAp+aYr+WQpuWPkeeUn+WPmOWMlgogICAgaGFzQ2hhbmdlZChuYW1lcywgcHJvcHMpIHsKICAgICAgbGV0IGN1ciA9IHt9OwogICAgICBsZXQgcHJldiA9IHt9OwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IGl0ZW0gPSBuYW1lc1tpXTsKICAgICAgICBjdXJbaXRlbV0gPSB0aGlzLmNyb3BQYXJhbXNbaXRlbV07CiAgICAgICAgcHJldltpdGVtXSA9IHByb3BzW2l0ZW1dOwogICAgICB9CiAgICAgIHJldHVybiAhdGhpcy5pc0VxdWl2YWxlbnQoY3VyLCBwcmV2LCBuYW1lcyk7CiAgICB9LAoKICAgIC8v5qC55o2u5Lik5Liq566A5Y2V5a+56LGh55qE5YC85q+U6L6D5a6D5Lus5piv5ZCm55u45ZCMCiAgICBpc0VxdWl2YWxlbnQoYSwgYiwgaW5jbHVkZSkgewogICAgICBpZiAoYSAhPSBudWxsICYmIGIgIT0gbnVsbCkgewogICAgICAgIGxldCBhUHJvcHMgPSBbXTsKICAgICAgICBsZXQgYVRlbXBzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoYSk7CiAgICAgICAgbGV0IGJQcm9wcyA9IFtdOwogICAgICAgIGxldCBiVGVtcHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhiKTsKCiAgICAgICAgLy/lj6rogIPomZEgaW5jbHVkZQogICAgICAgIGlmIChpbmNsdWRlIGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgICAgIC8vIOaVsOe7hAogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbmNsdWRlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGxldCBpdGVtID0gaW5jbHVkZVtpXTsKICAgICAgICAgICAgaWYgKGFUZW1wcy5pbmNsdWRlcyhpdGVtKSkgewogICAgICAgICAgICAgIGFQcm9wcy5wdXNoKGl0ZW0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChiVGVtcHMuaW5jbHVkZXMoaXRlbSkpIHsKICAgICAgICAgICAgICBiUHJvcHMucHVzaChpdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoaW5jbHVkZSBpbnN0YW5jZW9mIFJlZ0V4cCkgewogICAgICAgICAgLy/mraPliJkKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYVRlbXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGxldCBpdGVtID0gYVRlbXBzW2ldOwogICAgICAgICAgICBpZiAoaW5jbHVkZS50ZXN0KGl0ZW0pKSB7CiAgICAgICAgICAgICAgYVByb3BzLnB1c2goaXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYlRlbXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGxldCBpdGVtID0gYlRlbXBzW2ldOwogICAgICAgICAgICBpZiAoaW5jbHVkZS50ZXN0KGl0ZW0pKSB7CiAgICAgICAgICAgICAgYlByb3BzLnB1c2goaXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgYVByb3BzID0gYVRlbXBzOwogICAgICAgICAgYlRlbXBzID0gYlRlbXBzOwogICAgICAgIH0KCiAgICAgICAgaWYgKGFQcm9wcy5sZW5ndGggIT0gYlByb3BzLmxlbmd0aCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhUHJvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGxldCBwcm9wTmFtZSA9IGFQcm9wc1tpXTsKICAgICAgICAgIGlmIChhW3Byb3BOYW1lXSAhPT0gYltwcm9wTmFtZV0pIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSBpZiAoYSA9PT0gYikgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSwKICB9LAoKICAvL+ebkeWQrOWPguaVsOWPmOWMlgogIHdhdGNoOiB7CiAgICBjcm9wUGFyYW1zKHZhbCwgb2xkVmFsKSB7CiAgICAgIGlmICh0aGlzLl9pbnN0YW5jZSkgewogICAgICAgIGlmICh0aGlzLmhhc0NoYW5nZWQoWyJzcmMiXSwgb2xkVmFsKSkgewogICAgICAgICAgdGhpcy5faW5zdGFuY2Uuc2V0SW1hZ2UodGhpcy5jcm9wUGFyYW1zLnNyYyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoCiAgICAgICAgICB0aGlzLmhhc0NoYW5nZWQoCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICAicm90YXRlU2xpZGVyIiwKICAgICAgICAgICAgICAic3RhcnRBbmdsZSIsCiAgICAgICAgICAgICAgImVuZEFuZ2xlIiwKICAgICAgICAgICAgICAiZ2FwQW5nbGUiLAogICAgICAgICAgICAgICJsaW5lYXRpb25JdGVtV2lkdGgiLAogICAgICAgICAgICBdLAogICAgICAgICAgICBvbGRWYWwKICAgICAgICAgICkKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuX2luc3RhbmNlLmluaXRSb3RhdGVTbGlkZXIodGhpcy5jcm9wUGFyYW1zKTsKICAgICAgICB9CgogICAgICAgIGlmICgKICAgICAgICAgIHRoaXMuaGFzQ2hhbmdlZChbImNyb3BTaXplUGVyY2VudCJdLCBvbGRWYWwpIHx8CiAgICAgICAgICAhdGhpcy5pc0VxdWl2YWxlbnQoCiAgICAgICAgICAgIHRoaXMuY3JvcFBhcmFtcy5wb3NpdGlvbk9mZnNldCwKICAgICAgICAgICAgb2xkVmFsLnBvc2l0aW9uT2Zmc2V0LAogICAgICAgICAgICBbInRvcCIsICJsZWZ0Il0KICAgICAgICAgICkgfHwKICAgICAgICAgICF0aGlzLmlzRXF1aXZhbGVudCh0aGlzLmNyb3BQYXJhbXMuc2l6ZSwgb2xkVmFsLnNpemUsIFsKICAgICAgICAgICAgIndpZHRoIiwKICAgICAgICAgICAgImhlaWdodCIsCiAgICAgICAgICBdKQogICAgICAgICkgewogICAgICAgICAgdGhpcy5faW5zdGFuY2UudXBkYXRlQm94KHRoaXMuY3JvcFBhcmFtcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoCiAgICAgICAgICB0aGlzLmhhc0NoYW5nZWQoCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICAiYm9yZGVyV2lkdGgiLAogICAgICAgICAgICAgICJib3JkZXJDb2xvciIsCiAgICAgICAgICAgICAgImJvbGRDb3JuZXJMZW4iLAogICAgICAgICAgICAgICJjb3ZlckNvbG9yIiwKICAgICAgICAgICAgICAiYm9yZGVyRHJhdyIsCiAgICAgICAgICAgICAgImNvdmVyRHJhdyIsCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIG9sZFZhbAogICAgICAgICAgKQogICAgICAgICkgewogICAgICAgICAgdGhpcy5faW5zdGFuY2UuaW5pdEJveEJvcmRlcih0aGlzLmNyb3BQYXJhbXMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKAogICAgICAgICAgIXRoaXMuaXNFcXVpdmFsZW50KAogICAgICAgICAgICB0aGlzLmNyb3BQYXJhbXMuZnVuY0J0bnMsCiAgICAgICAgICAgIG9sZFZhbC5mdW5jQnRucywKICAgICAgICAgICAgL15bMC05XSokLwogICAgICAgICAgKQogICAgICAgICkgewogICAgICAgICAgdGhpcy5faW5zdGFuY2UuaW5pdEZ1bmNCdG5zKHRoaXMuY3JvcFBhcmFtcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5oYXNDaGFuZ2VkKFsic2NhbGVTbGlkZXIiLCAibWF4U2NhbGUiXSwgb2xkVmFsKSkgewogICAgICAgICAgdGhpcy5faW5zdGFuY2UuaW5pdFNjYWxlU2xpZGVyKHRoaXMuY3JvcFBhcmFtcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5oYXNDaGFuZ2VkKFsidGl0bGUiXSwgb2xkVmFsKSkgewogICAgICAgICAgdGhpcy5faW5zdGFuY2UuaW5pdFRpdGxlKHRoaXMuY3JvcFBhcmFtcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5jcm9wUGFyYW1zLnZpc2libGUgPT0gZmFsc2UpIHsKICAgICAgICAgIHRoaXMuX2luc3RhbmNlLmhpZGUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5faW5zdGFuY2Uuc2hvdygpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;AAGA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/sSimpleCrop/modules","sourcesContent":["<template></template>\n\n<script>\nimport Core from \"./index.js\";\n\nexport default {\n  _instance: null, //组件实例\n\n  props: [\"cropParams\"],\n\n  mounted() {\n    this.cropParams.cropCallback = this.cropCallback.bind(this);\n    this.cropParams.uploadCallback = this.uploadCallback.bind(this);\n    this.cropParams.closeCallback = this.closeCallback.bind(this);\n    this._instance = new Core(this.cropParams);\n  },\n\n  methods: {\n    //关闭回调\n    closeCallback() {\n      this.$emit(\"close\");\n    },\n\n    //上传图片回调\n    uploadCallback() {\n      let src = this._instance ? this._instance.src : this.cropParams.src;\n      this.$emit(\"upload\", src);\n    },\n\n    //裁剪回调\n    cropCallback() {\n      let $resultCanvas = this._instance ? this._instance.$resultCanvas : null;\n      this.$emit(\"crop\", $resultCanvas);\n    },\n\n    //属性是否发生变化\n    hasChanged(names, props) {\n      let cur = {};\n      let prev = {};\n      for (let i = 0; i < names.length; i++) {\n        let item = names[i];\n        cur[item] = this.cropParams[item];\n        prev[item] = props[item];\n      }\n      return !this.isEquivalent(cur, prev, names);\n    },\n\n    //根据两个简单对象的值比较它们是否相同\n    isEquivalent(a, b, include) {\n      if (a != null && b != null) {\n        let aProps = [];\n        let aTemps = Object.getOwnPropertyNames(a);\n        let bProps = [];\n        let bTemps = Object.getOwnPropertyNames(b);\n\n        //只考虑 include\n        if (include instanceof Array) {\n          // 数组\n          for (let i = 0; i < include.length; i++) {\n            let item = include[i];\n            if (aTemps.includes(item)) {\n              aProps.push(item);\n            }\n            if (bTemps.includes(item)) {\n              bProps.push(item);\n            }\n          }\n        } else if (include instanceof RegExp) {\n          //正则\n          for (let i = 0; i < aTemps.length; i++) {\n            let item = aTemps[i];\n            if (include.test(item)) {\n              aProps.push(item);\n            }\n          }\n          for (let i = 0; i < bTemps.length; i++) {\n            let item = bTemps[i];\n            if (include.test(item)) {\n              bProps.push(item);\n            }\n          }\n        } else {\n          aProps = aTemps;\n          bTemps = bTemps;\n        }\n\n        if (aProps.length != bProps.length) {\n          return false;\n        }\n\n        for (let i = 0; i < aProps.length; i++) {\n          let propName = aProps[i];\n          if (a[propName] !== b[propName]) {\n            return false;\n          }\n        }\n\n        return true;\n      } else if (a === b) {\n        return true;\n      } else {\n        return false;\n      }\n    },\n  },\n\n  //监听参数变化\n  watch: {\n    cropParams(val, oldVal) {\n      if (this._instance) {\n        if (this.hasChanged([\"src\"], oldVal)) {\n          this._instance.setImage(this.cropParams.src);\n        }\n\n        if (\n          this.hasChanged(\n            [\n              \"rotateSlider\",\n              \"startAngle\",\n              \"endAngle\",\n              \"gapAngle\",\n              \"lineationItemWidth\",\n            ],\n            oldVal\n          )\n        ) {\n          this._instance.initRotateSlider(this.cropParams);\n        }\n\n        if (\n          this.hasChanged([\"cropSizePercent\"], oldVal) ||\n          !this.isEquivalent(\n            this.cropParams.positionOffset,\n            oldVal.positionOffset,\n            [\"top\", \"left\"]\n          ) ||\n          !this.isEquivalent(this.cropParams.size, oldVal.size, [\n            \"width\",\n            \"height\",\n          ])\n        ) {\n          this._instance.updateBox(this.cropParams);\n        }\n\n        if (\n          this.hasChanged(\n            [\n              \"borderWidth\",\n              \"borderColor\",\n              \"boldCornerLen\",\n              \"coverColor\",\n              \"borderDraw\",\n              \"coverDraw\",\n            ],\n            oldVal\n          )\n        ) {\n          this._instance.initBoxBorder(this.cropParams);\n        }\n\n        if (\n          !this.isEquivalent(\n            this.cropParams.funcBtns,\n            oldVal.funcBtns,\n            /^[0-9]*$/\n          )\n        ) {\n          this._instance.initFuncBtns(this.cropParams);\n        }\n\n        if (this.hasChanged([\"scaleSlider\", \"maxScale\"], oldVal)) {\n          this._instance.initScaleSlider(this.cropParams);\n        }\n\n        if (this.hasChanged([\"title\"], oldVal)) {\n          this._instance.initTitle(this.cropParams);\n        }\n\n        if (this.cropParams.visible == false) {\n          this._instance.hide();\n        } else {\n          this._instance.show();\n        }\n      }\n    },\n  },\n};\n</script>\n\n<style scoped></style>\n"]}]}