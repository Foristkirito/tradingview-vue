{"remainingRequest":"/Users/suhang/Template/tradingview/demo2/node_modules/babel-loader/lib/index.js!/Users/suhang/Template/tradingview/demo2/src/components/sTradingview/mixin/webSocket.js","dependencies":[{"path":"/Users/suhang/Template/tradingview/demo2/src/components/sTradingview/mixin/webSocket.js","mtime":1599243920868},{"path":"/Users/suhang/Template/tradingview/demo2/node_modules/cache-loader/dist/cjs.js","mtime":1598844172828},{"path":"/Users/suhang/Template/tradingview/demo2/node_modules/babel-loader/lib/index.js","mtime":1598844172845}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcCI7CmltcG9ydCAkbG9kYXNoIGZyb20gJ2xvZGFzaCc7CmV4cG9ydCB2YXIgd2ViU29ja2V0TWl4aW4gPSB7CiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHdlYnNvY2tUaW1lOiAiIiAvL+W/g+i3swoKICAgIH07CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkge30sCiAgbWV0aG9kczogewogICAgLyoqCiAgICAgICAgICog6I635Y+W5o6o6YCB5pWw5o2uIO+8iOWPluS4gOS4quWAvOWwseWlve+8iQogICAgICAgICAqIGUge3N0cmluZ30gbG9hZD3liqDovb0gZ2V0PeiOt+WPlgogICAgICAgICAqLwogICAgd2ViU29ja2V0OiBmdW5jdGlvbiB3ZWJTb2NrZXQoZSkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICBpZiAoZSA9PSAiZ2V0IikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHR5cGVvZiBXZWJTb2NrZXQgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgYWxlcnQoIuaCqOeahOa1j+iniOWZqOS4jeaUr+aMgXNvY2tldCIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRyeSB7CiAgICAgICAgICBzZWxmLndlYnNvY2suY2xvc2UoKTsKICAgICAgICB9IGNhdGNoIChlKSB7fSAvLyDlrp7kvovljJZzb2NrZXQKCgogICAgICAgIHNlbGYud2Vic29jayA9IG5ldyBXZWJTb2NrZXQoc2VsZi53c1VybCk7IC8vIOebkeWQrHNvY2tldOi/nuaOpQoKICAgICAgICBzZWxmLndlYnNvY2sub25vcGVuID0gc2VsZi53ZWJzb2NrT3BlbjsgLy8g55uR5ZCsc29ja2V06ZSZ6K+v5L+h5oGvCgogICAgICAgIHNlbGYud2Vic29jay5vbmVycm9yID0gc2VsZi53ZWJzb2NrRXJyb3I7IC8vIOebkeWQrHNvY2tldOa2iOaBrwoKICAgICAgICBzZWxmLndlYnNvY2sub25tZXNzYWdlID0gc2VsZi53ZWJzb2NrTWVzc2FnZTsKICAgICAgfQogICAgfSwKICAgIC8v6ZO+5o6l54q25oCBCiAgICB3ZWJzb2NrT3BlbjogZnVuY3Rpb24gd2Vic29ja09wZW4oZSkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7IC8vICAgY29uc29sZS5sb2coInNvY2tldOi/nuaOpeaIkOWKnyIpOwoKICAgICAgdGhpcy53ZWJzb2NrU2VuZCgpOwogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBzZWxmLndlYnNvY2tIZWFydGJlYXQoKTsKICAgICAgfSwgMTAwMCk7CiAgICB9LAogICAgLy/lj5HpgIHmtojmga8KICAgIHdlYnNvY2tTZW5kOiBmdW5jdGlvbiB3ZWJzb2NrU2VuZChtc2cpIHsKICAgICAgaWYgKG1zZykgewogICAgICAgIHRoaXMud2Vic29jay5zZW5kKG1zZyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy53ZWJzb2NrLnNlbmQoSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgcmVxOiAiY29udHJhY3RrbGluZSIsCiAgICAgICAgICBzdWI6ICJjb250cmFjdDpLTGluZURhdGE6QlRDVVNEVDprbGluZV8iLmNvbmNhdCgkbG9kYXNoLmZpbmQodGhpcy50YWJzQXJyLCB7CiAgICAgICAgICAgIHZhbHVlOiB0aGlzLmludGVydmFsCiAgICAgICAgICB9KS53ZWJzb2NrU2VuZCwgIl8yNiIpCiAgICAgICAgfSkpOwogICAgICB9CiAgICB9LAogICAgLy/plJnor68KICAgIHdlYnNvY2tFcnJvcjogZnVuY3Rpb24gd2Vic29ja0Vycm9yKCkgewogICAgICAvLyAgIGNvbnNvbGUubG9nKCLov57mjqXplJnor68iKTsKICAgICAgdGhpcy53ZWJzb2NrQ2xvc2UoKTsKICAgIH0sCiAgICAvL+ebkeWQrOi/lOWbnua2iOaBrwogICAgd2Vic29ja01lc3NhZ2U6IGZ1bmN0aW9uIHdlYnNvY2tNZXNzYWdlKG1zZykgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHZhciByZXMgPSBKU09OLnBhcnNlKG1zZy5kYXRhKTsKCiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlcykpIHsKICAgICAgICB2YXIgYXJyYXlEYXRhID0gW107CiAgICAgICAgcmVzLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgYXJyYXlEYXRhLnB1c2goewogICAgICAgICAgICB0aW1lOiBpdGVtLkRhdGUgKiAxMDAwLAogICAgICAgICAgICBjbG9zZTogaXRlbS5DbG9zZSwKICAgICAgICAgICAgb3BlbjogaXRlbS5PcGVuLAogICAgICAgICAgICBoaWdoOiBpdGVtLkhpZ2gsCiAgICAgICAgICAgIGxvdzogaXRlbS5Mb3csCiAgICAgICAgICAgIHZvbHVtZTogaXRlbS5Wb2x1bWUKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIHNlbGYub25Mb2FkZWRDYWxsYmFjayhhcnJheURhdGEpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICghcmVzLmhhc093blByb3BlcnR5KCJwb25nIikpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHNlbGYub25SZWFsdGltZUNhbGxiYWNrKHsKICAgICAgICAgICAgICB0aW1lOiByZXMuRGF0ZSAqIDEwMDAsCiAgICAgICAgICAgICAgY2xvc2U6IHJlcy5DbG9zZSwKICAgICAgICAgICAgICBvcGVuOiByZXMuT3BlbiwKICAgICAgICAgICAgICBoaWdoOiByZXMuSGlnaCwKICAgICAgICAgICAgICBsb3c6IHJlcy5Mb3csCiAgICAgICAgICAgICAgdm9sdW1lOiByZXMuVm9sdW1lCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvL+W/g+i3swogICAgd2Vic29ja0hlYXJ0YmVhdDogZnVuY3Rpb24gd2Vic29ja0hlYXJ0YmVhdCgpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBzZWxmLndlYnNvY2tUaW1lID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgIHNlbGYud2Vic29ja1NlbmQoSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgcGluZzogbmV3IERhdGUoKS5nZXRUaW1lKCkKICAgICAgICB9KSk7CiAgICAgIH0sIDMwMDApOwogICAgfSwKICAgIC8v5pat5byA6L+e5o6lCiAgICB3c0Nsb3NlOiBmdW5jdGlvbiB3c0Nsb3NlKCkgewogICAgICBjb25zb2xlLmxvZygxMSk7CiAgICAgIHRoaXMud2Vic29jay5jbG9zZSgpOwogICAgfSwKICAgIC8v6L+e5o6l5YWz6ZetCiAgICB3ZWJzb2NrQ2xvc2U6IGZ1bmN0aW9uIHdlYnNvY2tDbG9zZSgpIHsKICAgICAgY29uc29sZS5sb2coInNvY2tldOW3sue7j+WFs+mXrSIpOwogICAgICBjbGVhckludGVydmFsKHRoaXMud2Vic29ja1RpbWUpOwogICAgfQogIH0KfTs="},{"version":3,"sources":["/Users/suhang/Template/tradingview/demo2/src/components/sTradingview/mixin/webSocket.js"],"names":["$lodash","webSocketMixin","data","websockTime","created","methods","webSocket","e","self","WebSocket","alert","websock","close","wsUrl","onopen","websockOpen","onerror","websockError","onmessage","websockMessage","websockSend","setTimeout","websockHeartbeat","msg","send","JSON","stringify","req","sub","find","tabsArr","value","interval","websockClose","res","parse","Array","isArray","arrayData","map","item","push","time","Date","Close","open","Open","high","High","low","Low","volume","Volume","onLoadedCallback","hasOwnProperty","onRealtimeCallback","setInterval","ping","getTime","wsClose","console","log","clearInterval"],"mappings":"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","sourcesContent":["import $lodash from 'lodash';\nexport const webSocketMixin = {\n    data() {\n        return {\n            websockTime: \"\", //心跳\n        }\n    },\n    created() {\n\n    },\n    methods: {\n        /**\n             * 获取推送数据 （取一个值就好）\n             * e {string} load=加载 get=获取\n             */\n        webSocket(e) {\n            const self = this;\n            if (e == \"get\") {\n                return;\n            }\n            if (typeof WebSocket === \"undefined\") {\n                alert(\"您的浏览器不支持socket\");\n            } else {\n                try {\n                    self.websock.close();\n                } catch (e) { }\n                // 实例化socket\n                self.websock = new WebSocket(self.wsUrl);\n                // 监听socket连接\n                self.websock.onopen = self.websockOpen;\n                // 监听socket错误信息\n                self.websock.onerror = self.websockError;\n                // 监听socket消息\n                self.websock.onmessage = self.websockMessage;\n            }\n        },\n        //链接状态\n        websockOpen(e) {\n            const self = this;\n            //   console.log(\"socket连接成功\");\n            this.websockSend();\n            setTimeout(function () {\n                self.websockHeartbeat();\n            }, 1000);\n        },\n        //发送消息\n        websockSend(msg) {\n            if (msg) {\n                this.websock.send(msg);\n            } else {\n                this.websock.send(\n                    JSON.stringify({\n                        req: \"contractkline\",\n                        sub: `contract:KLineData:BTCUSDT:kline_${$lodash.find(this.tabsArr, { value: this.interval }).websockSend}_26`,\n                    })\n                );\n            }\n        },\n        //错误\n        websockError() {\n            //   console.log(\"连接错误\");\n            this.websockClose();\n        },\n        //监听返回消息\n        websockMessage(msg) {\n            const self = this;\n            let res = JSON.parse(msg.data);\n            if (Array.isArray(res)) {\n                let arrayData = [];\n                res.map((item) => {\n                    arrayData.push({\n                        time: item.Date * 1000,\n                        close: item.Close,\n                        open: item.Open,\n                        high: item.High,\n                        low: item.Low,\n                        volume: item.Volume,\n                    });\n                });\n                self.onLoadedCallback(arrayData);\n            } else {\n                if (!res.hasOwnProperty(\"pong\")) {\n                    try {\n                        self.onRealtimeCallback({\n                            time: res.Date * 1000,\n                            close: res.Close,\n                            open: res.Open,\n                            high: res.High,\n                            low: res.Low,\n                            volume: res.Volume,\n                        });\n                    } catch (e) { }\n                }\n            }\n        },\n        //心跳\n        websockHeartbeat() {\n            const self = this;\n            self.websockTime = setInterval(function () {\n                self.websockSend(JSON.stringify({ ping: new Date().getTime() }));\n            }, 3000);\n        },\n        //断开连接\n        wsClose() {\n            console.log(11)\n            this.websock.close();\n        },\n        //连接关闭\n        websockClose() {\n            console.log(\"socket已经关闭\");\n            clearInterval(this.websockTime);\n        },\n    }\n}"]}]}